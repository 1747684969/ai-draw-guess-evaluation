# 将评价输出改为流式传输

## 需要修改的文件

### 1. 修改后端代理路由 `app/api/proxy/route.ts`
- 修改为支持流式传输，直接透传上游的流式响应
- 保持现有的安全检查和头部处理

### 2. 修改前端评价函数 `app/page.tsx`

#### 修改 `evaluateWithOlla` 函数
- 将 `stream: false` 改为 `stream: true`
- 使用 `ReadableStream` 读取流式响应
- 逐块处理并返回流式数据

#### 修改 `evaluateWithAPI` 函数
- 将 `stream: false` 改为 `stream: true`（Ollama/OpenAI格式）
- 使用 `ReadableStream` 读取流式响应
- 逐块处理并返回流式数据

#### 修改 `submitDrawing` 函数
- 创建新的状态 `streamedEvaluation` 用于存储流式评价内容
- 修改评价调用逻辑，使用流式处理
- 在流式传输过程中逐步更新 `streamedEvaluation` 状态

#### 更新 UI 显示
- 修改评价显示区域，显示流式传输的评价内容
- 添加流式传输的视觉反馈（如光标闪烁）

## 实现细节

1. **流式数据处理**：
   - 使用 `response.body.getReader()` 获取读取器
   - 使用 `TextDecoder` 解码数据
   - 逐块更新 UI

2. **错误处理**：
   - 保持现有的超时控制
   - 处理流式传输中断的情况

3. **用户体验**：
   - 流式传输时显示加载状态
   - 传输完成后显示完整评价